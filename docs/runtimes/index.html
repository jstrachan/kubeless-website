<!DOCTYPE html>
<html>
<!-- Head information -->
<head>
<meta charset='utf-8'>
<meta content='width=device-width' initial-scale='1' name='viewport'>
<!-- Always force latest IE rendering engine or request Chrome Frame -->
<!-- %meta{content: 'IE=edge,chrome=1', http-equiv: 'X-UA-Compatible'} -->
<link href='/assets/images/favicon/favicon-196x196.png' rel='icon' sizes='196x196' type='image/png'>
<link href='/assets/images/favicon/favicon-32x32.png' rel='icon' sizes='32x32' type='image/png'>
<link href='/assets/images/favicon/favicon-16x16.png' rel='icon' sizes='16x16' type='image/png'>
<link href='/assets/images/favicon/favicon-128.png' rel='icon' sizes='128x128' type='image/png'>
<link href='/assets/images/favicon/favicon.ico' rel='icon'>
<!-- Use title if it's in the page YAML frontmatter -->
<title>
Kubeless
</title>
<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css' media='screen' rel='stylesheet'>
<!-- Bitnami Design System -->
<link href='https://fonts.googleapis.com/css?family=Fira+Sans:300,400,700|Hind:300,400' media='screen' rel='stylesheet'>
<link href='//d1d5nb8vlsbujg.cloudfront.net/bitnami-ui/2.0.1/bitnami.ui.components.min.css' media='screen' rel='stylesheet'>
<link href='//d1d5nb8vlsbujg.cloudfront.net/bitnami-ui/2.0.1/bitnami.ui.min.css' media='screen' rel='stylesheet'>
<!-- Include the javascripts and the styles of the page -->
<link href="/assets/stylesheets/main.css" rel="stylesheet" />
<script src="/assets/javascripts/main.js"></script>
</head>

<!-- Main content -->
<body>
<div class='gradient-135-accent elevation-1'>
<div class='container'>
<header class='Header padding-v-big'>
<div class='row collapse-b-tablet align-center'>
<div class='col-4'>
<div class='Header__Logo'>
<a href="/"><img src="/assets/images/logo-white.svg" alt="Logo white" />
<span>
A Bitnami project
</span>
</a></div>
</div>
<div class='col-8'>
<nav class='text-r'>
<a href="/" class="margin-h-normal">Home</a>
<a href="/docs" class="margin-h-normal">Documentation</a>
<a href="https://github.com/kubeless/kubeless-ui" class="margin-h-normal">Kubeless UI</a>
<a href="https://serverless.com/framework/docs/providers/kubeless/guide/intro/" class="margin-h-normal">Serverless Plugin</a>
<a href="https://github.com/kubeless" class="margin-l-normal">GitHub</a>
</nav>
</div>
</div>
</header>

</div>
</div>
<main class='container margin-t-big'>
<div class='row collapse-b-phone-land'>
<div class='col-3'>
<h4 class='margin-t-bigger'>
<img src="/assets/images/logo-dark.svg" alt="Kubeless logo" class="float-l avatar avatar-medium" />
<div class='padding-v-small'>
Documentation
</div>
</h4>
<ul class='remove-style padding-small'>
<li>
<b>Usage</b>
</li>
<li class='margin-v-small'>
<a href="/docs/quick-start">Quick Start
</a></li>
<li class='margin-v-small'>
<a href="/docs/runtimes">Runtimes
</a></li>
<li class='margin-v-small'>
<a href="/docs/http-triggers">Exposing Functions
</a></li>
<li class='margin-v-small'>
<a href="/docs/monitoring">Monitoring
</a></li>
<li class='margin-v-small'>
<a href="/docs/autoscaling">Autoscaling
</a></li>
<li class='margin-v-small'>
<a href="/docs/building-functions">Build Function Images
</a></li>
<li class='margin-v-small'>
<a href="/docs/use-existing-kafka">Use a Custom Apache Kafka
</a></li>
<li class='padding-t-big'>
<b>Cloud Providers</b>
</li>
<li class='margin-v-small'>
<a href="/docs/kubeless-on-azure-container-services">Azure Container Services
</a></li>
<li class='margin-v-small'>
<a href="/docs/GKE-deployment">Google Kubernetes Engine
</a></li>
<li class='padding-t-big'>
<b>Development</b>
</li>
<li class='margin-v-small'>
<a href="/docs/architecture">Architecture
</a></li>
<li class='margin-v-small'>
<a href="/docs/dev-guide">Development Guide
</a></li>
<li class='margin-v-small'>
<a href="/docs/implementing-new-runtime">Implementing a New Runtime
</a></li>
<li class='margin-v-small'>
<a href="/docs/debugging">Debugging
</a></li>
<li class='margin-v-small'>
<a href="/docs/function-controller-configuration">Kubeless Controller Configuration
</a></li>
<li class='margin-v-small'>
<a href="/docs/release-flow">Release Flow
</a></li>
<li class='margin-v-small'>
<a href="/docs/troubleshooting">Troubleshooting
</a></li>
</ul>

</div>
<div class='col-9'>
<h1>Runtimes support</h1>

<p>Right now Kubeless has support for the following runtimes:</p>

<ul>
<li>Python: For the branch 2.7.X</li>
<li>NodeJS: For the branches 6.X and 8.X</li>
<li>Ruby: For the branch 2.4.X</li>
<li>PHP: For the branch 7.2.X</li>
</ul>

<p>Each runtime is encapsulated in a container image. The reference to these images are injected in the Kubeless controller. You can find source code of all runtimes in <code>docker/runtime</code>.</p>

<p>Runtimes have a maximum timeout set by the environment variable FUNC_TIMEOUT. This environment variable can be set using the CLI option <code>--timeout</code>. The default value is 180 seconds. If a function takes more than that in being executed, the process will be terminated.</p>

<h2>Runtimes interface</h2>

<p>Every function receives two arguments: <code>event</code> and <code>context</code>. The first argument contains information about the source of the event that the function has received. The second contains general information about the function like its name or maximum timeout. This is a representation in YAML of a Kafka event:</p>

<pre><code class="yaml">event:                                  
  data:                                         # Event data
    foo: &quot;bar&quot;                                  # The data is parsed as JSON when required
  event-id: &quot;2ebb072eb24264f55b3fff&quot;            # Event ID
  event-type: &quot;application/json&quot;                # Event content type
  event-time: &quot;2009-11-10 23:00:00 +0000 UTC&quot;   # Timestamp of the event source
  event-namespace: &quot;kafkatriggers.kubeless.io&quot;  # Event emitter
  extensions:                                   # Optional parameters
    request: ...                                # Reference to the request received 
                                                # (specific properties will depend on the function language)
context:
    function-name: &quot;pubsub-nodejs&quot;
    timeout: &quot;180&quot;
    runtime: &quot;nodejs6&quot;
    memory-limit: &quot;128M&quot;
</code></pre>

<p>You can check basic examples of every language supported in the <a href="https://github.com/kubeless/kubeless/tree/master/examples">examples</a> folder.</p>

<h2>Configuring Default Runtime Container Images</h2>

<p>The Kubeless controller defines a set of default container images per supported runtime variant.</p>

<p>These default container images can be configured via Kubernetes environment variables on the Kubeless controller&#39;s deployment container. Or modifying the <code>kubeless-config</code> ConfigMap that is deployed along with the Kubeless controller.</p>

<p>If you want to obtain the list of possible runtimes execute:</p>

<pre><code class="console">$ kubeless get-server-config
INFO[0000] Current Server Config:
INFO[0000] Supported Runtimes are: python2.7, python3.4, python3.6, nodejs6, nodejs8, ruby2.4, dotnetcore2.0
</code></pre>

<p>If you want to deploy a custom runtime using an environment variable these are some examples:</p>

<table><thead>
<tr>
<th>Runtime Variant</th>
<th>Environment Variable Name</th>
</tr>
</thead><tbody>
<tr>
<td>NodeJS 6.X HTTP Trigger</td>
<td><code>NODEJS6_RUNTIME</code></td>
</tr>
<tr>
<td>NodeJS 8.X Event Trigger</td>
<td><code>NODEJS8_PUBSUB_RUNTIME</code></td>
</tr>
<tr>
<td>Python 2.7.x HTTP Trigger</td>
<td><code>PYTHON2.7_RUNTIME</code></td>
</tr>
<tr>
<td>Ruby 2.4.x HTTP Trigger</td>
<td><code>RUBY2.4_RUNTIME</code></td>
</tr>
<tr>
<td>...</td>
<td>...</td>
</tr>
</tbody></table>

<h1>Runtime variants</h1>

<p>Every runtime use a web framework that is in charge of receiving requests and redirect them to the function.</p>

<h3>Node.js Trigger</h3>

<p>For the Node.js runtime we start an <a href="http://expressjs.com">Express</a> server and we include the routes for serving the health check and exposing the monitoring metrics. Apart from that we enable <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">CORS</a> requests and <a href="https://github.com/expressjs/morgan">Morgan</a> for handling the logging in the server. Monitoring is supported if the function is synchronous or if it uses promises.</p>

<p>When using the Node.js runtime, it is possible to configure a <a href="https://docs.npmjs.com/misc/scope#associating-a-scope-with-a-registry">custom registry or scope</a> in case a function needs to install modules from a different source. For doing so it is necessary to set up the environment variables <em>NPM_REGISTRY</em> and <em>NPM_SCOPE</em> when deploying the function:</p>

<pre><code class="console">$ kubeless function deploy myFunction --runtime nodejs6 \
                                --env NPM_REGISTRY=http://my-registry.com \
                                --env NPM_SCOPE=@myorg \
                                --dependencies package.json \
                                --handler test.foobar \
                                --from-file test.js
</code></pre>

<h3>Python HTTP Trigger</h3>

<p>For python we use <a href="https://bottlepy.org">Bottle</a> and we also add routes for health check and monitoring metrics.</p>

<h3>Ruby HTTP Trigger</h3>

<p>For the case of Ruby we use <a href="http://www.sinatrarb.com">Sinatra</a> as web framework and we add the routes required for the function and the health check. Monitoring is currently not supported yet for this framework. PR is welcome :-)</p>

<h1>Scheduled Trigger</h1>

<p>This is meant for functions that should be triggered following a certain schedule. For specifying the execution frequency  we use the <a href="https://en.wikipedia.org/wiki/Cron">Cron</a> format. Every time a scheduled function is executed, a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/jobs-run-to-completion/">Job</a> is started. This Job will do a HTTP GET request to the function service and will be successful as far as the function returns 200 OK.</p>

<p>For executing scheduled functions we use Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/">CronJobs</a> using mostly the default options which means:
 - If a Job fails, it won&#39;t be restarted but it will be retried in the next scheduled event. The maximum time that a Job will exist is specified with the function timeout (180 seconds by default).
 - The concurrency policy is set to <code>Allow</code> so concurrent jobs may exists.
 - The history limit is set to maintain as maximum three successful jobs (and one failed).</p>

<p>If for some reason you want to modify one of the default values for a certain function you can execute <code>kubectl edit cronjob trigger-&lt;func_name&gt;</code> (where <code>func_name</code> is the name of your function) and modify the fields required. Once it is saved the CronJob will be updated.</p>

<h1>Monitoring functions</h1>

<p>Some Kubeless runtimes expose metrics at <code>/metrics</code> endpoint and these metrics will be collected by Prometheus. We also include a prometheus setup in <a href="https://github.com/kubeless/kubeless/blob/master/manifests/monitoring/prometheus.yaml"><code>manifests/monitoring</code></a> to help you easier set it up. The metrics collected are: Number of calls, succeeded and error executions and the time spent per call.</p>

<h1>Custom Runtime (Alpha)</h1>

<blockquote>
<p>NOTE: This feature is under heavy development and may change in the future</p>
</blockquote>

<p>We are providing a way to define custom runtime in form of a container image. This way you are able to use any language or any binary with Kubeless as far as the image satisfies the following conditions:
 - It runs a web server listening in the port 8080
 - It exposes the endpoint <code>/healthz</code> to perform the container <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/">liveness probe</a>
 - (Optional) It serves <a href="https://prometheus.io">Prometheus</a> metrics in the endpoint <code>/metrics</code></p>

<p>To deploy the container image you just need to specify it using the Kubeless CLI:</p>

<pre><code class="console">$ kubeless function deploy --runtime-image bitnami/tomcat:9.0 webserver
$ kubeless function ls
NAME        NAMESPACE   HANDLER             RUNTIME     TYPE    TOPIC
webserver   default                                     HTTP
</code></pre>

<p>Now you can call your function like any other:</p>

<pre><code class="console">$ kubeless function call webserver
...
&lt;h2&gt;If you&#39;re seeing this, you&#39;ve successfully installed Tomcat. Congratulations!&lt;/h2&gt;
</code></pre>

<p>Note that you can also use your own image and inject different functions. That means you have to manage how your runtime starts and looks for the injected function and executes it. Kubeless injects the function into the runtime container via a <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configmap/">Kubernetes ConfigMap</a> object mounted at <code>/kubeless</code> folder, so make sure your runtime looks for function at that folder. Let&#39;s see an example:</p>

<p>First we need to create a base image. For this example we will use the Python web server that you can find <a href="../docker/runtime/python-2.7/http-trigger/kubeless.py">in the runtimes folder</a>. We will use the following Dockerfile:</p>

<pre><code class="dockerfile">FROM python:2.7-slim

RUN pip install bottle==0.12.13 cherrypy==8.9.1 wsgi-request-logger prometheus_client lxml

ADD kubeless.py /

EXPOSE 8080
CMD [&quot;python&quot;, &quot;/kubeless.py&quot;]
</code></pre>

<p>Once you have built the image you need to push it to a registry to make it available within your cluster. Finally you can call the <code>deploy</code> command specifying the custom runtime image and the function you want to inject:</p>

<pre><code class="console">$ kubeless function deploy \
  --runtime-image tuna/kubeless-python:0.0.6 \
  --from-file ./handler.py \
  --handler handler.hello \
  --runtime python2.7 \
  hello
$ kubeless function ls
NAME        NAMESPACE   HANDLER         RUNTIME     TYPE    TOPIC
get-python  default     foo.foo       python2.7 HTTP
$ kubeless function call get-python
Connecting to function...
Forwarding from 127.0.0.1:30000 -&gt; 8080
Forwarding from [::1]:30000 -&gt; 8080
Handling connection for 30000
hello world
</code></pre>

<p>Note that it is possible to specify <code>--dependencies</code> as well when using custom images and install them using an Init container but that is only possible for the supported runtimes. You can get the list of supported runtimes executing <code>kubeless get-server-config</code>.</p>

<p>When using a runtime not supported your function will be stored as <code>/kubeless/function</code> without extension. For example, injecting a file <code>my-function.jar</code> would result in the file being mounted as <code>/kubeless/my-fuction</code>).</p>

</div>
</div>
</main>
<div class='margin-t-giant'>
<div class='Footer'>
<div class='container padding-h-big padding-v-bigger'>
<div class='Footer__Border padding-t-big'>
<div class='row collapse-b-phone-land'>
<div class='col-6'>
<h4 class='inverse margin-reset'>
<img src="/assets/images/logo-white.svg" alt="Kubeless logo" class="Footer__Logo" />
</h4>
<p class='type-color-iron type-small margin-reset'>
© Kubeless 2018 | All Rights Reserved.
</p>
</div>
<div class='col-6 text-r'>
<a href="https://github.com/kubeless" class="margin-l-small"><img src="/assets/images/social/github.svg" alt="See the Github Profile of the Kubeless project" />
</a></div>
</div>
</div>
</div>
</div>

</div>
</body>
</html>
<script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
